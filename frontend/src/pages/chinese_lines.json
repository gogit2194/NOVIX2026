{
  "lines": [
    [
      2,
      " * 文枢 WenShape - 深度上下文感知的智能体小说创作系统"
    ],
    [
      44,
      " * WritingSessionContent - 写作会话主流程组件"
    ],
    [
      46,
      " * 统一的写作 IDE 界面，集成 AI 写作、编辑、分析等功能。"
    ],
    [
      47,
      " * 使用 IDE Layout 提供三段式布局（活动栏、左侧面板、编辑区、右侧面板、底部状态栏）。"
    ],
    [
      49,
      " * 主要功能："
    ],
    [
      50,
      " * - 实时 WebSocket 连接管理和消息处理"
    ],
    [
      51,
      " * - 章节内容编辑和版本管理"
    ],
    [
      52,
      " * - AI 驱动的写作、编辑、分析建议"
    ],
    [
      53,
      " * - 交互式对话和反馈流程"
    ],
    [
      54,
      " * - 草稿保存和历史记录"
    ],
    [
      57,
      " * @param {boolean} [isEmbedded=false] - 是否为嵌入模式（默认完整模式）"
    ],
    [
      58,
      " * @returns {JSX.Element} 写作会话主界面"
    ],
    [
      66,
      "    // 项目和会话基本信息 / Project and Session Information"
    ],
    [
      68,
      "    // 项目数据状态 / Project data from API"
    ],
    [
      79,
      "    // 项目切换时清理所有会话状态，防止数据污染"
    ],
    [
      80,
      "    // 使用 useRef 判断 projectId 是否真正变化，避免不必要的清理"
    ],
    [
      83,
      "            // 项目真正切换了：清理所有写作会话状态"
    ],
    [
      161,
      "    // AI 锁定章：写作/编辑进行中时，右侧面板锁死在该章节（中央可切换查看/手改其他章节）"
    ],
    [
      168,
      "    // 轻提示（不打断、不强跳转）"
    ],
    [
      285,
      "                if (data.type === 'start_ack') appendProgressEvent({ stage: 'session_start', message: '会话已启动' }, wsChapterKey);"
    ],
    [
      367,
      "                        pushNotice(`第 ${wsChapterKey} 章撰写完成，可切换查看。`);"
    ],
    [
      377,
      "                    addMessage('assistant', '草稿已生成，可继续反馈或手动编辑。', wsChapterKey);"
    ],
    [
      409,
      "                            appendProgressEvent({ stage: 'connection', message: '连接中断，正在重连…' }, NO_CHAPTER_KEY);"
    ],
    [
      412,
      "                            appendProgressEvent({ stage: 'connection', message: '连接已恢复' }, NO_CHAPTER_KEY);"
    ],
    [
      415,
      "                            appendProgressEvent({ stage: 'connection', message: '连接已断开' }, NO_CHAPTER_KEY);"
    ],
    [
      555,
      "    // 监听 Context 中的 Dialog 状态"
    ],
    [
      577,
      "        // 缓存当前章节内容，避免切章丢失"
    ],
    [
      583,
      "        // 非写作/编辑进行中：切章时清理流式与差异态"
    ],
    [
      589,
      "            pushNotice(`正在撰写第 ${lockedKey} 章，AI 面板已锁定；已切换查看第 ${nextChapterKey} 章。`);"
    ],
    [
      598,
      "        // 优先使用本地缓存，减少切章时的“空白闪烁”"
    ],
    [
      646,
      "            addMessage('system', `已创建章节：${normalizedChapter}`, normalizedChapter);"
    ],
    [
      652,
      "            addMessage('error', '创建章节失败: ' + e.message);"
    ],
    [
      697,
      "    // Auto Save（类似 VSCode：检测到变更后自动保存）"
    ],
    [
      735,
      "                addMessage('error', '自动保存失败: ' + (e.response?.data?.detail || e.message));"
    ],
    [
      779,
      "    // 当资源管理器清空/删除当前章节时，主动回到空态，避免编辑区残留旧章节内容"
    ],
    [
      870,
      "                    pushNotice(`第 ${resolvedChapterKey} 章撰写完成，可切换查看。`);"
    ],
    [
      893,
      "    // 监听 Context 中的文档选择（章节或卡片）"
    ],
    [
      954,
      "                    addMessage('error', '加载卡片详情失败: ' + e.message);"
    ],
    [
      967,
      "            alert('请先选择章节');"
    ],
    [
      990,
      "        appendProgressEvent({ stage: 'session_start', message: '正在准备上下文…' }, chapterKey);"
    ],
    [
      995,
      "                chapter_title: chapterInfo.chapter_title || `章节 ${chapter}`,"
    ],
    [
      1004,
      "                throw new Error(result.error || '会话启动失败');"
    ],
    [
      1009,
      "                    appendProgressEvent({ stage: 'scene_brief', message: '场景简报已生成（可展开查看）', payload: result.scene_brief }, chapterKey);"
    ],
    [
      1022,
      "                appendProgressEvent({ stage: 'scene_brief', message: '场景简报已生成（可展开查看）', payload: result.scene_brief }, chapterKey);"
    ],
    [
      1046,
      "                addMessage('assistant', '草稿已生成，可继续反馈或手动编辑。', chapterKey);"
    ],
    [
      1049,
      "            addMessage('error', '启动失败: ' + e.message, chapterKey);"
    ],
    [
      1077,
      "                throw new Error(result.error || '回答问题失败');"
    ],
    [
      1084,
      "                    appendProgressEvent({ stage: 'scene_brief', message: '场景简报已生成（可展开查看）', payload: result.scene_brief }, chapterKey);"
    ],
    [
      1096,
      "                appendProgressEvent({ stage: 'scene_brief', message: '场景简报已生成（可展开查看）', payload: result.scene_brief }, chapterKey);"
    ],
    [
      1119,
      "                addMessage('assistant', '草稿已生成，可继续反馈或手动编辑。', chapterKey);"
    ],
    [
      1123,
      "            addMessage('error', '生成失败: ' + e.message, chapterKey);"
    ],
    [
      1135,
      "        appendProgressEvent({ stage: 'scene_brief', message: '场景简报已生成（可展开查看）', payload: data }, chapterOverride);"
    ],
    [
      1152,
      "        addMessage('assistant', '草稿已生成，可继续反馈或手动编辑。', chapterOverride);"
    ],
    [
      1169,
      "        addMessage('assistant', '终稿已完成。', chapterOverride);"
    ],
    [
      1192,
      "            addMessage('user', `修改指令：${textToSubmit}`);"
    ],
    [
      1193,
      "            appendProgressEvent({ stage: 'edit_suggest', message: '正在生成差异修改建议…' });"
    ],
    [
      1223,
      "                    addMessage('system', '检测到修改建议疑似截断，已自动补齐原文末尾，请检查差异。');"
    ],
    [
      1230,
      "                    throw new Error('未能生成可应用的差异修改：请复制粘贴要修改的原句/段落，或使用“选区编辑”进行精确定位。');"
    ],
    [
      1235,
      "                    message: `差异修改建议已生成（${diff.stats.additions || 0} 新增 / ${diff.stats.deletions || 0} 删除）`"
    ],
    [
      1240,
      "                    reason: lastFeedbackRef.current || '根据用户指令进行调整'"
    ],
    [
      1255,
      "                addMessage('assistant', '已生成差异修改建议：可查看差异并选择“接受”或“撤销”。');"
    ],
    [
      1262,
      "            addMessage('error', '编辑失败: ' + e.message);"
    ],
    [
      1445,
      "                throw new Error('卡片名称不能为空');"
    ],
    [
      1513,
      "            addMessage('system', '卡片已更新');"
    ],
    [
      1517,
      "            addMessage('error', '卡片保存失败: ' + (detail || e.message));"
    ],
    [
      1550,
      "                                    <p className=\"text-xs text-ink-400 font-mono uppercase tracking-wider\">{activeCard.type === 'character' ? '角色卡片' : '世界卡片'}</p>"
    ],
    [
      1559,
      "                                title=\"关闭卡片编辑\""
    ],
    [
      1568,
      "                                <label className=\"text-xs font-bold text-ink-500 tracking-wider\">名称</label>"
    ],
    [
      1577,
      "                                <label className=\"text-xs font-bold text-ink-500 tracking-wider\">星级</label>"
    ],
    [
      1583,
      "                                    <option value={3}>三星（必须关注）</option>"
    ],
    [
      1584,
      "                                    <option value={2}>二星（重要）</option>"
    ],
    [
      1585,
      "                                    <option value={1}>一星（可选）</option>"
    ],
    [
      1590,
      "                                <label className=\"text-xs font-bold text-ink-500 tracking-wider\">别名</label>"
    ],
    [
      1594,
      "                                    placeholder=\"多个别名用逗号分隔\""
    ],
    [
      1602,
      "                                        <label className=\"text-xs font-bold text-ink-500 tracking-wider\">类别</label>"
    ],
    [
      1606,
      "                                            placeholder=\"世界元素类别\""
    ],
    [
      1611,
      "                                        <label className=\"text-xs font-bold text-ink-500 tracking-wider\">规则</label>"
    ],
    [
      1624,
      "                                            placeholder=\"每行一条规则\""
    ],
    [
      1628,
      "                                        <label className=\"text-xs font-bold text-ink-500 tracking-wider\">不可变</label>"
    ],
    [
      1634,
      "                                            <option value=\"unset\">未设置</option>"
    ],
    [
      1635,
      "                                            <option value=\"true\">不可变</option>"
    ],
    [
      1636,
      "                                            <option value=\"false\">可变</option>"
    ],
    [
      1644,
      "                                <label className=\"text-xs font-bold text-ink-500 tracking-wider\">描述</label>"
    ],
    [
      1657,
      "                                    placeholder=\"请简要描述\""
    ],
    [
      1673,
      "                                <span className=\"brand-logo text-4xl text-ink-900/40\">文枢</span>"
    ],
    [
      1676,
      "                                请在左侧选择资源，或使用快捷键 Cmd+B 切换面板"
    ],
    [
      1698,
      "                                placeholder=\"请输入章节标题\""
    ],
    [
      1711,
      "                                    originalVersion=\"当前正文\""
    ],
    [
      1712,
      "                                    revisedVersion=\"修改建议\""
    ],
    [
      1766,
      "                                    placeholder=\"开始写作...\""
    ],
    [
      1788,
      "                        ? `AI 正在撰写第 ${String(aiLockedChapter)} 章：右侧对话已锁定，请切换回该章节继续。`"
    ],
    [
      1793,
      "                        ? `已选中 ${countChars(selectionInfo.text)} 字（未添加）`"
    ],
    [
      1798,
      "                        ? `已添加选区 ${countChars(attachedSelection.text)} 字`"
    ],
    [
      1837,
      "                        addMessage('system', '请先选择章节。');"
    ],
    [
      1843,
      "                            addMessage('system', '正文非空：主笔仅在正文为空时可用，请切换到编辑模式。');"
    ],
    [
      1888,
      "            : (chapterInfo.chapter ? (chapterInfo.chapter_title || `章节 ${chapterInfo.chapter}`) : null),"
    ],
    [
      1889,
      "        aiHint: agentBusy && aiLockedChapter ? `正在撰写第 ${String(aiLockedChapter)} 章` : null,"
    ],
    [
      1943,
      " * WritingSession - 写作会话入口"
    ],
    [
      1944,
      " * 提供 IDE 上下文并渲染主容器。"
    ]
  ]
}